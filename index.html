<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Vista previa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Vista previa para redes sociales -->
  <meta property="og:title" content="">
  <meta property="og:description" content="">
  <meta property="og:image" content="">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <!-- Google Fonts disponibles -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Playfair+Display&family=Fira+Code&family=Raleway&family=Quicksand&family=Pacifico&family=Source+Serif+4&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  
  
    
  

  <style>
    body {
      font-family: 'Raleway', sans-serif;
      background-image: url("/static/img/mini_1_980.jpeg");
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-position: center;
      padding-top: 70px;
    }
    h1, h2, h3, .btn, .card {
      font-family: 'Raleway', sans-serif;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      z-index: -1;
    }
    .fondo-animado {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -2;
      background: radial-gradient(circle at 20% 30%, rgba(255,255,255,0.08), transparent 40%),
                  radial-gradient(circle at 80% 70%, rgba(255,255,255,0.06), transparent 40%);
      animation: moverFondo 40s ease-in-out infinite;
      background-size: 200% 200%;
      pointer-events: none;
    }
    html {
      scroll-behavior: auto;
    }
    .card {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border-radius: 12px;
      overflow: hidden;
      will-change: transform, box-shadow;
      padding: 12px;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .modo-oscuro .card:hover {
      box-shadow: 0 8px 20px rgba(255,255,255,0.2);
    }
    .modo-claro .card:hover {
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }
    .card-img-top {
      width: 100%;
      max-width: 300px;
      height: auto;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .card-body {
      padding: 10px;
    }
    .card-title {
      font-size: 1rem;
    }
    .card-text {
      font-size: 0.9rem;
    }
    .modo-claro .card {
      background-color: #fff;
      color: #333;
      border: none;
    }
    .modo-oscuro .card {
      background-color: rgba(0,0,0,0.6);
      color: white;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .color-principal {
      color: inherit; /* o un color fijo, ej. #ff6f61 */
    }
    .bg-principal {
      background-color: transparent; /* o un color fijo */
    }
    .modo-oscuro {
      color: white;
    }
    .modo-claro {
      color: #333;
    }
    .barra-navegacion {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      display: flex;
      justify-content: center;
      gap: 16px;
      padding: 12px 20px;
      box-shadow: 0 2px 6px rgba(255, 255, 255, 0.1);
    }
    .barra-navegacion button {
      font-family: 'Raleway', sans-serif;
      font-weight: 600;
      font-size: 16px;
      padding: 10px 20px;
      border-radius: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: white;
      box-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    .barra-navegacion button:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }
    .barra-wrapper {
      z-index: 1000;
    }
    .panel-grupos {
      position: fixed;
      max-height: 50vh; /* Altura m√°xima global */
      overflow-y: auto; /* Desplazamiento vertical global */
      left: 0;
      right: 0;
      z-index: 906;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      padding: 1px 0;
      text-align: center;
      box-shadow: 0 2px 6px rgba(255, 255, 255, 0.1);
    }
    .panel-grupos button {
      font-family: 'Raleway', sans-serif;
      font-weight: 600;
      margin: 6px;
      padding: 2px 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 30px;
      background: rgba(255, 255, 255, 0.05);
      color: white;
      box-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .panel-grupos button:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }
    .oculta {
      display: none !important;
    }
    .logo { 
      height: 10vw; 
      max-height: 380px; 
      filter: brightness(1.5) contrast(1.2) drop-shadow(0 0 14px White);
      transition: filter 0.3s ease;
      animation: pulsoLogo 4s ease-in-out infinite;
    }
    @keyframes pulsoLogo {
      0%, 100% {
        filter: brightness(1.5) contrast(1.2) drop-shadow(0 0 14px None);
      }
      50% {
        filter: brightness(1.8) contrast(1.3) drop-shadow(0 0 20px None);
      }
    }
    .descripcion-emprendimiento {
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 20px;
      border-radius: 10px;
      display: inline-block;
      max-width: 800px;
      white-space: pre-line;
      text-align: center;
      text-indent: 20px;
      font-size: 16px;
      line-height: 1.6;
      box-shadow: 0 0 6px rgba(255,255,255,0.3);
    }
    .btn-grupo {
      position: relative;
      padding: 8px 16px;
      margin: 5px;
      border-radius: 20px;
      font-weight: bold;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 6px rgba(255,255,255,0.3);
      transition: all 0.3s ease;
      overflow: hidden;
    }
    .modo-claro .btn-grupo {
      background-color: transparent;
      color: white;
      border: none;
    }
    .modo-oscuro .btn-grupo {
      background-color: rgba(255, 255, 255, 0.05);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 4px rgba(255,255,255,0.1);
    }
    .btn-grupo::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 20px;
      z-index: -1;
    }
    .modo-claro .btn-grupo::before {
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.08), transparent 70%);
    }
    .modo-oscuro .btn-grupo::before {
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05), transparent 70%);
    }
    .btn-grupo:hover {
      background-color: #fff;
      color: #333;
      transform: scale(1.05);
      box-shadow: 0 0 8px None;
    }
    .btn-grupo.active {
      box-shadow: none;
    }
    .btn-whatsapp {
      background-color: #25D366;
      border: none;
      padding: 8px 16px;
      color: white;
      border-radius: 5px;
      font-size: 14px;
    }
    .btn-volver-arriba {
      background-color: white;
      color: black;
      border: none;
      font-size: 20px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-volver-arriba:hover {
      background-color: #f0f0f0;
      transform: scale(1.1);
    }
    .btn-volver-arriba:focus,
    .btn-volver-arriba:active,
    .btn-volver-arriba:visited {
      outline: none;
      box-shadow: none;
      background-color: white;
      color: black;
    }
    .grupo-section {
      display: none;
      min-height: 100vh;
    }
    .grupo-section.active {
      display: block !important;
    }
    .social-icons {
      margin-top: 40px;
      text-align: center;
    }
    .social-icons img {
      width: 40px;
      margin: 0 10px;
      transition: transform 0.3s ease;
      filter: drop-shadow(0 0 3px white);
    }
    .social-icons img:hover {
      transform: scale(1.1);
      filter: drop-shadow(0 0 0 transparent);
    }
    .bloque-ubicacion {
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 12px 16px;
      border-radius: 10px;
      text-align: center;
      max-width: 600px;
      margin: 20px auto 0;
      box-shadow: 0 0 6px rgba(255,255,255,0.3);
    }
    #carrito {
      position: fixed;
      bottom: 80px;
      right: 20px;
      padding: 15px;
      border-radius: 10px;
      width: 300px;
      z-index: 999;
      display: none;
    }
    .modo-oscuro #carrito {
      background-color: rgba(0,0,0,0.85);
      color: white;
      border: 1px solid white;
      box-shadow: 0 0 10px white;
    }
    .modo-claro #carrito {
      background-color: #fff;
      color: #333;
      border: 1px solid #ccc;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    #toggleCarrito {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      padding: 10px 14px;
      border-radius: 50px;
      font-weight: bold;
      box-shadow: 0 0 5px white;
    }
    .modo-oscuro #toggleCarrito {
      background-color: transparent;
      color: black;
      border: none;
    }
    .modo-claro #toggleCarrito {
      background-color: transparent;
      color: white;
      border: none;
    }
    .panel-subcategorias {
      position: fixed;
      max-height: 50vh; /* Altura m√°xima global */
      overflow-y: auto; /* Desplazamiento vertical global */
      left: 0;
      right: 0;
      z-index: 908;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      padding: 1px 0;
      text-align: center;
      box-shadow: 0 2px 6px rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    .panel-subcategorias button {
      font-family: 'Raleway', sans-serif;
      font-weight: 600;
      margin: 6px;
      padding: 1px 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 30px;
      background: rgba(255, 255, 255, 0.05);
      color: white;
      box-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .panel-subcategorias button:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
    }
    @media (max-width: 600px) {
  .logo {
    height: 140px !important;
  }
  .barra-navegacion {
    padding: 8px 10px;
    gap: 8px;
  }
  .barra-navegacion button {
    font-size: 14px;
    padding: 8px 15px;
  }
  .panel-grupos {
    padding: 1px 0;
    max-height: 50vh; /* Altura m√°xima para que sea desplazable si hay muchos botones */
    overflow-y: auto; /* Hace el panel desplazable verticalmente */
  }
  .panel-grupos button {
    font-size: 13px;
    padding: 1px 6px;
    border-radius: 8px;
   }
  .panel-subcategorias {
    padding: 1px 0;
    max-height: 50vh; /* Altura m√°xima para el panel de subcategor√≠as */
    overflow-y: auto; /* Hace el panel desplazable verticalmente */
  }
  .panel-subcategorias button {
    font-size: 13px;
    padding: 1px 6px;
    border-radius: 8px;
  }
}
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes moverFondo {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }
  </style>
</head>
<body class="container py-5 modo-oscuro">
  <div class="barra-wrapper">
    <nav class="barra-navegacion">
      <button id="btnProductos" onclick="mostrarTodos()">Productos</button>
      <button id="btnContacto" onclick="irAContacto()">Contacto</button>
    </nav>
    <div id="panelGrupos" class="panel-grupos oculta">
      
    </div>
  </div>

  <div id="panelSubcategorias" class="panel-subcategorias oculta"></div>

  <button id="volverArriba" class="btn btn-volver-arriba" style="position: fixed; bottom: 20px; left: 20px; display: none; z-index: 1000;">
    ‚Üë
  </button>

  
    <div class="text-center my-3">
      <img src="/static/img/Copilot_20251101_125947.png"
           alt="Logo"
           class="img-fluid logo mx-auto d-block">
    </div>
  


  

  


  <div class="text-center my-4">
    <select id="ordenPrecio" class="form-select w-auto d-inline-block">
      <option value="asc">Precio: Menor a mayor</option>
      <option value="desc">Precio: Mayor a menor</option>
    </select>
  </div>


  
    <div class="text-center mb-4">
      <div class="descripcion-emprendimiento">
        dsa
      </div>
    </div>
  




  <div id="contenedor-grupos"></div>

  <div class="text-center mt-5">
    <a href="/descargar" class="btn btn-primary px-5">
      Descargar sitio
    </a>
  </div>

  <div class="social-icons">
    
      <a href="https://www.facebook.com/profile.php?id=100070385734178" target="_blank">
        <img src="/static/img/facebook.png" alt="Facebook">
      </a>
    
    
      <a href="https://www.instagram.com/dsad" target="_blank">
        <img src="/static/img/instagram.png" alt="Instagram">
      </a>
    
    
      <a href="https://wa.me/549" target="_blank">
        <img src="/static/img/whatsapp.png" alt="WhatsApp">
      </a>
    
  </div>

  
    <div id="ubicacion" class="bloque-ubicacion text-center mt-4">
      <p style="margin-bottom: 6px;">
        üìç Corrientes 731 (Local 4)
      </p>
      
        <a href="https://maps.app.goo.gl/ei74Cv" target="_blank" style="text-decoration: none;">
          <span style="margin-right: 6px;">‚ûú</span>
          <img src="/static/img/map.png" alt="Ver en Google Maps" style="width: 30px;">
        </a>
      
    </div>
  

  <button id="toggleCarrito">üõí</button>

  <div id="carrito">
    <h5>üõí Tu carrito</h5>
    <ul id="listaCarrito"></ul>
    <p><strong>Total:</strong> $<span id="totalCarrito">0</span></p>
    <div class="d-grid gap-2">
  <button class="btn btn-sm btn-danger" onclick="vaciarCarrito()">Vaciar carrito</button>

  
    <a id="enviarCarrito" class="btn btn-sm btn-success" target="_blank">Enviar por WhatsApp</a>
  


  </div>
<!-- Aviso flotante de precio actualizado -->
<div id="avisoPrecio" class="alert alert-success text-center" role="alert"
     style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999;">
  ‚úî Precio actualizado
</div>

    <!-- Aviso flotante de talle actualizado -->
<div id="avisoTalle" class="alert alert-info text-center" role="alert"
     style="display: none; position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%); z-index: 9999;">
  ‚úî Talle actualizado
</div>

  <script>
    const configWhatsApp = "https://wa.me/549";

    window.addEventListener('scroll', () => {
      const btn = document.getElementById('volverArriba');
      btn.style.display = window.scrollY > 300 ? 'block' : 'none';
      btn.style.backgroundColor = 'white';
      btn.style.color = 'black';
    });
    const subcategoriasPorGrupo = {
      
    };

    document.getElementById('volverArriba').onclick = () => {
      window.scrollTo({ top: 0, behavior: 'auto' }); // Cambiado a 'auto' para evitar deslizamiento
    };
    
    function mostrarGrupo(nombre, event, auto = false) {
  console.log("üß™ Grupo seleccionado:", nombre, "auto:", auto);

  const grupoId = 'grupo_' + nombre.toLowerCase().replace(/\s+/g, '_');
  const grupoActivo = document.getElementById(grupoId);
  document.querySelectorAll('.grupo-section').forEach(div => div.classList.remove('active', 'initial-load'));
  if (grupoActivo) {
    grupoActivo.classList.add('active');
    if (auto) grupoActivo.classList.add('initial-load');
  }

  document.querySelectorAll('.btn-grupo').forEach(btn => btn.classList.remove('active'));
  if (event?.target) event.target.classList.add('active');

  const subcategorias = subcategoriasPorGrupo[nombre] || [];
  const panel = document.getElementById('panelSubcategorias');
  panel.innerHTML = '';

  const bloques = grupoActivo?.querySelectorAll('.subgrupo-bloque');
  console.log("üîç Bloques encontrados:", bloques?.length || 0);

  subcategorias.forEach(sub => {
    if (!sub || sub.trim().toLowerCase() === 'general') return;
    const btn = document.createElement('button');
    btn.textContent = sub;
    btn.className = 'btn-grupo';
    btn.onclick = () => filtrarSubcategoria(nombre, sub);
    panel.appendChild(btn);
    console.log("üß± Bot√≥n creado para subcategor√≠a:", sub);
  });

  if (!auto) {
    panel.classList.remove('oculta');
    bloques?.forEach((bloque, i) => {
      bloque.style.display = 'block';
      console.log(`üîÑ Mostrando bloque ${i}:`, bloque.dataset.subgrupo);
    });

    if (subcategorias.length > 0) {
      console.log("üéØ Aplicando filtro por primera subcategor√≠a:", subcategorias[0]);
      filtrarSubcategoria(nombre, subcategorias[0]);
    }
  } else {
    panel.classList.add('oculta');
    if (subcategorias.length > 0) {
      console.log("üéØ Auto-carga: filtrando por subcategor√≠a inicial:", subcategorias[0]);
      filtrarSubcategoria(nombre, subcategorias[0]);
    }
  }
}

   function filtrarSubcategoria(grupo, subgrupo) {
  console.log("üéØ Filtrando grupo:", grupo, "por subgrupo:", subgrupo);

  const grupoId = 'grupo_' + grupo.toLowerCase().replace(/\s+/g, '_');
  const grupoDiv = document.getElementById(grupoId);
  if (!grupoDiv) {
    console.warn("‚ö†Ô∏è Grupo no encontrado:", grupoId);
    return;
  }

  const bloques = grupoDiv.querySelectorAll('.subgrupo-bloque');
  console.log("üîç Bloques en grupo:", bloques.length);

  bloques.forEach((bloque, i) => {
    const subgrupoActual = bloque.dataset.subgrupo?.trim() || '';
    const mostrar = subgrupoActual.toLowerCase() === subgrupo.trim().toLowerCase();
    bloque.style.display = mostrar ? 'block' : 'none';

    console.log(`üîé Bloque ${i}: subgrupo=${subgrupoActual}, mostrar=${mostrar}`);
  });

  window.scrollTo({ top: 0, behavior: 'auto' });
}

window.onload = function() {
  const panelSubcategorias = document.getElementById('panelSubcategorias');
  const panelGrupos = document.getElementById('panelGrupos');
  panelSubcategorias.classList.add('oculta');
  panelGrupos.classList.add('oculta');

  const primerGrupo = Object.keys(subcategoriasPorGrupo)[0];
  const primerSub = subcategoriasPorGrupo[primerGrupo]?.find(s => s.toLowerCase() !== 'general') || '';
  if (primerGrupo && primerSub) {
    mostrarGrupo(primerGrupo, null, true);
    filtrarSubcategoria(primerGrupo, primerSub);
  }

  document.getElementById('toggleCarrito').onclick = function() {
    const carritoDiv = document.getElementById('carrito');
    if (!carritoDiv) return;
    carritoDiv.style.display = carritoDiv.style.display === 'none' ? 'block' : 'none';
  };
};


    let carrito = [];

   function agregarAlCarritoDOM(nombre, idPrecioSpan, idCantidad, id_base) {
  const cantidadInput = document.getElementById(idCantidad);
  const precioSpan = document.getElementById(idPrecioSpan);
  const talleSelect = document.getElementById("talle_" + id_base);

  const cantidad = parseInt(cantidadInput?.value) || 1;
  const precio = parseFloat(precioSpan?.textContent?.trim()) || 0;
  const talleElegido = talleSelect?.value || "";

  console.log("üõí Intentando agregar al carrito:", {
    nombre,
    precio,
    cantidad,
    talle: talleElegido,
    id_base
  });

  const existente = carrito.find(item => item.id_base === id_base && item.talle === talleElegido);
  if (existente) {
    existente.cantidad += cantidad;
    console.log("üîÅ Producto ya en carrito, sumando cantidad:", existente);
  } else {
    const nuevoItem = { nombre, precio, cantidad, id_base, talle: talleElegido };
    carrito.push(nuevoItem);
    console.log("‚úÖ Producto agregado al carrito:", nuevoItem);
  }

  actualizarCarrito();
}

async function pagarConMercadoPago() {
  try {
    const response = await fetch('/pagar', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ carrito })
    });
    const data = await response.json();

    if (data.preference_id) {
      // ‚úÖ Abrir checkout con MercadoPago.js V2
      mp.checkout({
        preference: { id: data.preference_id },
        autoOpen: true
      });
    } else if (data.init_point) {
      // Fallback al checkout cl√°sico si no hay preference_id
      window.location.href = data.init_point;
    } else {
      alert("Error al generar el pago: " + (data.error || "desconocido"));
    }
  } catch (err) {
    console.error("‚ö†Ô∏è Error al conectar con /pagar:", err);
    alert("Error interno al intentar pagar");
  }
}

function editarPrecio(id) {
  const span = document.getElementById("precio_" + id);
  if (!span) {
    console.warn("‚ùå No se encontr√≥ el span con id:", "precio_" + id);
    return;
  }

  const valorActual = span.textContent.replace("$", "").trim();
  console.log("üß™ Editando precio para:", id, "| Valor actual:", valorActual);

  const input = document.createElement("input");
  input.type = "number";
  input.value = valorActual;
  input.className = "form-control form-control-sm d-inline-block";
  input.style.width = "80px";
  input.id = "input_precio_" + id;

  // Guardar al salir del input
  input.onblur = () => {
    console.log("üì§ onblur: guardando precio para", id, "con valor:", input.value);
    guardarPrecio(id);
  };

  // Guardar al presionar Enter
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      console.log("‚èé Enter presionado: guardando precio para", id, "con valor:", input.value);
      input.blur(); // dispara onblur
    }
  });

  span.replaceWith(input);
  input.focus();
}

  
function guardarPrecio(id) {
  console.log("üü° Iniciando guardarPrecio para:", id);

  const input = document.getElementById("input_precio_" + id);
  if (!input) {
    console.warn("‚ùå No se encontr√≥ el input con id:", "input_precio_" + id);
    return;
  }

  const nuevoValor = parseFloat(input.value);
  if (isNaN(nuevoValor)) {
    alert("‚ùå El precio ingresado no es v√°lido");
    return;
  }

  console.log("üì° Enviando a Firestore:", { id, nuevoPrecio: nuevoValor });

  fetch('/actualizar-precio', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, nuevoPrecio: nuevoValor })
  })
    .then(res => res.json())
    .then(data => {
      if (data.status === "ok") {
        console.log("‚úÖ Precio confirmado en Firestore para", id);

        // Feedback visual inmediato en DOM
        const span = document.createElement("span");
        span.id = "precio_" + id;
        const fmt = new Intl.NumberFormat('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        span.textContent = fmt.format(nuevoValor);
        span.className = input.className;
        span.classList.add("text-success");
        input.replaceWith(span);
        setTimeout(() => span.classList.remove("text-success"), 1000);

        if (typeof mostrarAvisoPrecio === "function") mostrarAvisoPrecio();
      } else {
        alert("‚ùå No se pudo actualizar el precio en el servidor");
      }
    })
    .catch(err => {
      console.error("‚ùå Error de red:", err);
      alert("‚ùå Error de conexi√≥n al guardar el precio");
    });
}


function loginAdmin(event) {
  event.preventDefault();

  // Capturar usuario y clave
  const usuario = document.getElementById("usuario_login").value.trim();
  const clave = document.getElementById("clave_login").value.trim();

  // Referencia al bot√≥n de submit
  const btn = event.target.querySelector('button[type="submit"]');
  if (btn) {
    btn.disabled = true;
    btn.textContent = 'Entrando...'; // feedback visual
  }

  // Llamada al backend
  fetch("/login-admin", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ usuario, clave })
  })
    .then(res => res.json())
    .then(data => {
      if (data.status === "ok") {
        alert("‚úÖ Acceso concedido");
        location.href = window.location.href; // recarga la vista
      } else {
        alert("‚ùå " + data.message);
      }
    })
    .catch(err => {
      console.error("‚ùå Error en login:", err);
      alert("‚ùå Error al intentar login");
    })
    .finally(() => {
      // Restaurar el bot√≥n siempre al terminar
      if (btn) {
        btn.disabled = false;
        btn.textContent = 'Entrar';
      }
    });
}

// Detectar env√≠o autom√°tico del formulario
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("form-login-admin");
  if (form) {
    form.addEventListener("submit", loginAdmin);
  }
});

    
function editarTalles(id) {
  // 1) Buscar el select de talles
  const select = document.getElementById("talle_" + id);
  if (!select) {
    console.warn("‚ùå No se encontr√≥ el select de talles:", "talle_" + id);
    return;
  }

  // 2) Construir el valor actual como texto "S, M, L"
  const opciones = Array.from(select.options).map(opt => opt.value).filter(Boolean);
  const valorActual = opciones.join(", ");
  console.log("üß™ Editando talles para:", id, "| Valor actual:", valorActual);

  // 3) Crear input texto
  const input = document.createElement("input");
  input.type = "text";
  input.value = valorActual;
  input.className = "form-control form-control-sm d-inline-block";
  input.style.width = "200px";
  input.id = "input_talles_" + id;

  // Guardar al salir
  input.onblur = () => {
    console.log("üì§ onblur: guardando talles para", id, "con valor:", input.value);
    guardarTalles(id);
  };

  // Guardar con Enter
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") input.blur();
  });

  // 4) Reemplazar select por el input
  select.replaceWith(input);
  input.focus();
}

function guardarTalles(id) {
  const input = document.getElementById("input_talles_" + id);
  if (!input) {
    console.warn("‚ùå No se encontr√≥ el input de talles:", "input_talles_" + id);
    return;
  }

  // 1) Parsear "S, M, L" ‚Üí ["S","M","L"]
  const nuevosTalles = input.value.split(",").map(t => t.trim()).filter(t => t);
  console.log("üì° Enviando talles a Firestore:", { id, talles: nuevosTalles });

  // 2) Enviar al backend
  fetch('/actualizar-talles', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, talles: nuevosTalles })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "ok") {
      console.log("‚úÖ Talles confirmados en Firestore para", id);

      // 3) Regenerar el select con las nuevas opciones
      const nuevoSelect = document.createElement("select");
      nuevoSelect.id = "talle_" + id;
      nuevoSelect.className = "form-select form-select-sm w-auto d-inline-block";

      if (nuevosTalles.length > 0) {
        nuevosTalles.forEach(t => {
          const opt = document.createElement("option");
          opt.value = t;
          opt.textContent = t;
          nuevoSelect.appendChild(opt);
        });
      } else {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "Sin talles";
        nuevoSelect.appendChild(opt);
      }

      // Reemplazar input por select y feedback
      input.replaceWith(nuevoSelect);
      nuevoSelect.classList.add("text-success");
      setTimeout(() => nuevoSelect.classList.remove("text-success"), 1000);
    } else {
      alert("‚ùå No se pudo actualizar los talles en el servidor");
    }
  })
  .catch(err => {
    console.error("‚ùå Error de red:", err);
    alert("‚ùå Error de conexi√≥n al guardar los talles");
  });
}

function actualizarFirestore(id, datos) {
  if (!id || typeof datos !== "object" || Object.keys(datos).length === 0) {
    console.warn("‚ö†Ô∏è Datos incompletos para actualizar Firestore:", { id, datos });
    return;
  }

  console.log("üì° Enviando actualizaci√≥n a Firestore para", id, "‚Üí", datos);

  fetch("/actualizar-firestore", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, ...datos })
  })
    .then(res => {
      console.log("üì¨ Respuesta recibida del backend:", res.status);
      return res.json();
    })
    .then(data => {
      console.log("üì® Payload recibido:", data);
      if (data.status === "ok") {
        console.log("‚úÖ Firestore actualizado para", id);
        if (typeof mostrarAvisoFirestore === "function") {
          console.log("üîî Ejecutando mostrarAvisoFirestore()");
          mostrarAvisoFirestore();
        }
      } else {
        console.warn("‚ùå Error en respuesta del backend:", data);
        alert("‚ùå No se pudo actualizar Firestore");
      }
    })
    .catch(err => {
      console.error("‚ùå Error de red al actualizar Firestore:", err);
      alert("‚ùå Error de conexi√≥n al guardar los datos");
    });
}

    function guardarProducto(producto) {
  fetch('/guardar-producto', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ producto })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'ok') {
      console.log("‚úÖ Producto guardado");
      mostrarAviso("Producto guardado correctamente");
    } else {
      console.error("‚ùå Error al guardar:", data.message);
      mostrarAviso("Error al guardar producto");
    }
  })
  .catch(err => {
    console.error("‚ùå Error de red:", err);
    mostrarAviso("Error de conexi√≥n");
  });
}
function cargarProductos() {
  fetch('/ver-productos')
    .then(res => res.json())
    .then(productos => {
      console.log("üì¶ Productos recibidos:", productos);
      renderizarProductos(productos);
    })
    .catch(err => {
      console.error("‚ùå Error al cargar productos:", err);
    });
}

function mostrarAvisoPrecio() {
  const aviso = document.getElementById("avisoPrecio");
  aviso.style.display = "block";
  setTimeout(() => {
    aviso.style.display = "none";
  }, 2000);
}

function pagarConMercadoPago() {
  fetch('/pagar', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ carrito })
  })
  .then(res => res.json())
  .then(data => {
    if (data.init_point) {
      window.location.href = data.init_point;
    } else {
      alert("Error al generar pago");
    }
  })
  .catch(err => {
    console.error("‚ö†Ô∏è Error al conectar con /pagar:", err);
    alert("Error interno al intentar pagar");
  });
}


function eliminarProducto(id_base, talle, event) {
  event.stopPropagation(); // üëà evita que el clic cierre el carrito
  carrito = carrito.filter(p => !(p.id_base === id_base && p.talle === talle));
  actualizarCarrito();
}


    function vaciarCarrito() {
      carrito = [];
      actualizarCarrito();
    }
    function actualizarPrecioEnCarrito(nombre, nuevoPrecio) {
  let cambio = false;
  carrito.forEach(item => {
    if (item.nombre === nombre && item.precio !== nuevoPrecio) {
      console.log(`üîÑ Actualizando precio en carrito para ${nombre}: ${item.precio} ‚Üí ${nuevoPrecio}`);
      item.precio = nuevoPrecio;
      cambio = true;
    }
  });
  if (cambio) actualizarCarrito();
}

function sincronizarPreciosDelCarrito() {
  carrito.forEach(item => {
    const idPrecio = "precio_" + (item.id_base || item.nombre.replace(/ /g, "_"));
    const precioSpan = document.getElementById(idPrecio);
    if (precioSpan) {
      const precioActual = parseFloat(precioSpan.textContent);
      if (!isNaN(precioActual)) {
        item.precio = precioActual;
      } else {
        console.warn("‚ö†Ô∏è Precio no num√©rico en DOM para", idPrecio);
      }
    } else {
      console.warn("‚ö†Ô∏è No se encontr√≥ el span de precio para", idPrecio);
    }
  });
}

function actualizarCarrito() {
  sincronizarPreciosDelCarrito();

  const lista = document.getElementById('listaCarrito');
  const total = document.getElementById('totalCarrito');
  if (!lista || !total) {
    console.warn("‚ö†Ô∏è No se encontr√≥ listaCarrito o totalCarrito en el DOM");
    return;
  }

  lista.innerHTML = '';
  let suma = 0;

  carrito.forEach(item => {
    const subtotal = item.precio * item.cantidad;
    suma += subtotal;

    lista.innerHTML += `
      <li style="display: flex; justify-content: space-between; align-items: center;">
        <span>${item.nombre}${item.talle ? ' (' + item.talle + ')' : ''} x ${item.cantidad} - $${subtotal.toFixed(2)}</span>
        <button onclick="eliminarProducto('${item.id_base}', '${item.talle}', event)" 
                style="background: none; border: none; color: red; font-weight: bold; font-size: 16px; cursor: pointer;">
          ‚ùå
        </button>
      </li>`;
  });

  total.textContent = suma.toFixed(2);

  const mensaje = encodeURIComponent(
    `Hola, quiero consultar por:\n` +
    carrito.map(i => `- ${i.nombre}${i.talle ? ' (' + i.talle + ')' : ''} x ${i.cantidad}: $${(i.precio * i.cantidad).toFixed(2)}`).join('\n') +
    `\nTotal estimado: $${suma.toFixed(2)}`
  );

  const link = document.getElementById('enviarCarrito');
  if (link) {
    link.href = configWhatsApp + '?text=' + mensaje;
  } else {
    console.warn("‚ö†Ô∏è No se encontr√≥ el bot√≥n 'enviarCarrito' para actualizar el link de WhatsApp");
  }

  console.log("üõí Carrito actualizado:", carrito);
}


    function mostrarTodos() {
      const panelGrupos = document.getElementById('panelGrupos');
      const panelSub = document.getElementById('panelSubcategorias');

      panelGrupos.classList.toggle('oculta');

      if (!panelSub.classList.contains('oculta')) {
        panelSub.classList.add('oculta');
      }
    }
    function irAContacto() {
      const contacto = document.getElementById('ubicacion');
      if (contacto) contacto.scrollIntoView({ behavior: 'auto' }); // Cambiado a 'auto'
    }
    function ajustarPosicionesPaneles() {
      const panelGrupos = document.getElementById('panelGrupos');
      const panelSub = document.getElementById('panelSubcategorias');
      const barraNav = document.querySelector('.barra-navegacion');

      if (!panelGrupos.classList.contains('oculta')) {
        const alturaBarra = barraNav ? barraNav.offsetHeight : 0;
        const alturaGrupos = panelGrupos ? panelGrupos.offsetHeight : 0;
        panelGrupos.style.top = alturaBarra + 'px';
        panelGrupos.style.position = 'fixed';
        panelGrupos.style.left = '0';
        panelGrupos.style.right = '0';
      }
      if (!panelSub.classList.contains('oculta')) {
        const alturaBarra = barraNav ? barraNav.offsetHeight : 0;
        const alturaGrupos = panelGrupos ? panelGrupos.offsetHeight : 0;
        const margenAdicional = 19; // Margen para evitar superposiciones
        const desplazamientoArriba = -20; // Ajuste para subir un poco si lo necesitas
        panelSub.style.top = (alturaBarra + alturaGrupos + margenAdicional + desplazamientoArriba) + 'px';
        panelSub.style.position = 'fixed';
        panelSub.style.left = '0';
        panelSub.style.right = '0';
      } else {
        panelSub.style.top = '';
      }
    }
    // Recalcular posiciones al cargar y al cambiar el tama√±o de la ventana
    window.addEventListener('load', ajustarPosicionesPaneles);
    window.addEventListener('resize', ajustarPosicionesPaneles);
    // Recalcular posiciones cuando se muestra un panel
    document.getElementById('btnProductos').addEventListener('click', function() {
      setTimeout(ajustarPosicionesPaneles, 0); // Ajuste despu√©s de que el DOM se actualice
    });
    document.querySelectorAll('.btn-grupo').forEach(btn => {
      btn.addEventListener('click', function() {
        setTimeout(ajustarPosicionesPaneles, 0); // Ajuste despu√©s de mostrar subcategor√≠as
      });
    });
  </script>
  <script type="module">
  const usarFirestore = false;
  const modoAdmin = false;
  const grupos = {};

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDde7U-pgzMHvhTbrckn4iUjXlmIWtbsjE",
    authDomain: "appweb-bd7c8.firebaseapp.com",
    projectId: "appweb-bd7c8",
    storageBucket: "appweb-bd7c8.firebasestorage.app",
    messagingSenderId: "553348257877",
    appId: "1:553348257877:web:5a940631dd6729bd381cdc"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Suscripci√≥n √∫nica (evit√° duplicar en bloque normal)
  if (usarFirestore) {
    onSnapshot(collection(db, "productos"), (snapshot) => {
      const productos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      console.log("üì¶ Productos en vivo:", productos);

      productos.forEach(p => {
        const precioSpan = document.getElementById("precio_" + p.id_base);
        if (precioSpan) {
          const fmt = new Intl.NumberFormat('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          precioSpan.textContent = fmt.format(p.precio);
        }

        const talleSelect = document.getElementById("talle_" + p.id_base);
        if (talleSelect && Array.isArray(p.talles)) {
          talleSelect.innerHTML = p.talles.map(t => `<option value="${t}">${t}</option>`).join('');
        }
      });
    });
  }
    
  // Activar primer grupo y subgrupo (con grupos ya serializado)
  setTimeout(() => {
    const grupoKeys = Object.keys(grupos);
    if (grupoKeys.length === 0) return;

    const primerGrupoId = grupoKeys[0].trim().toLowerCase().replace(/\s+/g, '_');
    const primerGrupoDiv = document.getElementById('grupo_' + primerGrupoId);
    if (primerGrupoDiv) primerGrupoDiv.classList.add('active');

    const subgrupos = Object.keys(grupos[grupoKeys[0]]);
    const primerSubgrupoNombre = subgrupos[0]?.trim().toLowerCase();

    if (primerGrupoId && primerSubgrupoNombre) {
      filtrarSubcategoria(grupoKeys[0], subgrupos[0]);
    }
  }, 100);

  // Cerrar carrito al hacer clic fuera (listener √∫nico)
  document.addEventListener('click', function(event) {
    const carritoDiv = document.getElementById('carrito');
    const toggleBtn = document.getElementById('toggleCarrito');
    if (!carritoDiv || !toggleBtn) return;

    const visible = carritoDiv.style.display === 'block';
    const clicFuera = !carritoDiv.contains(event.target) && !toggleBtn.contains(event.target);
    if (visible && clicFuera) {
      carritoDiv.style.display = 'none';
    }
  });

  // Ordenar productos por precio (listener √∫nico)
  document.getElementById('ordenPrecio')?.addEventListener('change', function () {
    const orden = this.value;
    const grupoActivo = document.querySelector('.grupo-section.active');
    if (!grupoActivo) return;

    const bloques = grupoActivo.querySelectorAll('.subgrupo-bloque');
    bloques.forEach(bloque => {
      const productos = Array.from(bloque.querySelectorAll('.col-lg-4, .col-md-6, .col-sm-12'));
      const contenedor = bloque.querySelector('.row');
      if (!contenedor) return;

      productos.sort((a, b) => {
        const precioA = parseFloat(a.querySelector('span[id^="precio_"]').textContent) || 0;
        const precioB = parseFloat(b.querySelector('span[id^="precio_"]').textContent) || 0;
        return orden === 'asc' ? precioA - precioB : precioB - precioA;
      });

      contenedor.innerHTML = '';
      productos.forEach(p => contenedor.appendChild(p));
    });
  });

  // Ocultar paneles al hacer clic fuera (listener √∫nico)
  document.addEventListener('click', function(event) {
    const panelGrupos = document.getElementById('panelGrupos');
    const panelSub = document.getElementById('panelSubcategorias');
    if (!panelGrupos || !panelSub) return;

    const esClickDentroGrupos = panelGrupos.contains(event.target);
    const esClickDentroSub = panelSub.contains(event.target);
    const esBotonGrupo = event.target.classList.contains('btn-grupo');
    const esBotonNavegacion = !!event.target.closest('.barra-navegacion');

    if (!esClickDentroGrupos && !esClickDentroSub && !esBotonGrupo && !esBotonNavegacion) {
      panelGrupos.classList.add('oculta');
      panelSub.classList.add('oculta');
    }
  });

  console.log("üß™ modoAdmin:", false);
  console.log("üß™ modoAdminIntentado:", false);
</script>
<script src="https://sdk.mercadopago.com/js/v2"></script>
<script>
  // Inicializar con tu Public Key (segura para frontend)
  const mp = new MercadoPago('', { locale: 'es-AR' });
</script>
</body>
</html>